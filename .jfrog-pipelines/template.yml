valuesFilePath: values.yml

{{ if eq "true" "{{ .Values.controls.cron.enabled }}" }}
# The cron time when the job is executed. Default 0 0 5 ? * 1 should be redefined.
resources:
  - name: "{{ .Values.metadata.pipelineName }}_cron_trigger"
    type: CronTrigger
    configuration:
      interval: "{{ .Values.controls.cron.expression }}"
      branches:
        include: "^{{ .Values.controls.cron.branch }}$"
{{ end }}

pipelines:
  - name: {{ .Values.metadata.pipelineName }}
    configuration:
      environmentVariables:
        readOnly:
          timeUnit:
            values: ["year", "month", "day", "hour", "minute"]
            default: "month"
            description: The unit of the time interval. year, month, day, hour or minute are allowed values. Default month.
          timeInterval:
            default: 1
            description: The time interval to look back before deleting an artifact. Default 1.
          repos:
            default: ""
            description: A list of repositories to clean. This parameter is required.
          dryRun:
            default: "false"
            description: If this parameter is passed, artifacts will not actually be deleted. Default false.
          paceTimeMS:
            default: 0
            description: The number of milliseconds to delay between delete operations. Default 0.
      
      {{ if eq "true" "{{ .Values.controls.cron.enabled }}" }}
      inputResources:
        - name: {{ .Values.metadata.pipelineName }}_cron_trigger
      {{ end }}

    steps:
      - name: create_repos
        type: Bash
        configuration:
          environmentVariables:
            BRANCH_NAME: ''
        execution:
          onStart:
            - echo $BRANCH_NAME
          onExecute:
            - printenv